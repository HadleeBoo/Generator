<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D&D Ultimate Loot Generator (Expanded)</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#eee}
  header{background:#222;padding:12px;text-align:center;font-size:20px;font-weight:bold;border-bottom:2px solid #444}
  .container{display:flex;flex-wrap:wrap;padding:12px;gap:12px}
  .panel{background:#1b1b1b;padding:12px;border:1px solid #333;border-radius:8px;flex:1;min-width:280px;max-height:700px;overflow:auto}
  label{display:block;margin:6px 0 2px;font-size:13px;color:#bbb}
  select,input[type=number],input[type=text]{width:100%;padding:6px;border-radius:4px;border:1px solid #444;background:#222;color:#eee}
  button{background:#4cafef;color:#111;padding:10px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin-top:10px;width:100%}
  button:hover{background:#6ccfff}
  .loot-log{max-height:600px;overflow-y:auto;font-size:14px;background:#0d0d0d;padding:10px;border-radius:6px;border:1px solid #333}
  .loot-item{border-bottom:1px solid #333;padding:4px 0}
  .good{color:#4ae18f}
  .bad{color:#e14a4a}
  .rarity-common{color:#ccc}
  .rarity-uncommon{color:#1eff00}
  .rarity-rare{color:#0070dd}
  .rarity-very-rare{color:#a335ee}
  .rarity-legendary{color:#ff8000}
  .healing{color:#ff4d4d;font-weight:bold}
  .funny{color:#ffd700}
  .price{color:#f0e68c; font-size:13px}
  .controls-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
</style>
</head>
<body>
<header>D&D Ultimate Loot Generator (Expanded)</header>
<div class="container">
  <div class="panel">
    <h3>Loot Options</h3>
    <label>Origin</label>
    <select id="origin">
      <option>Chest</option>
      <option>Enemy</option>
      <option>Boss</option>
      <option>Container</option>
      <option>Pickpocket</option>
    </select>
    <label>Quantity</label>
    <input type="number" id="quantity" value="3" min="1" max="50">
    <label>Cursed / Blessed</label>
    <select id="alignment">
      <option>Neutral</option>
      <option>Cursed</option>
      <option>Blessed</option>
    </select>
    <label>Loot Quality</label>
    <select id="quality">
      <option>Common</option>
      <option>Uncommon</option>
      <option>Rare</option>
      <option>Very Rare</option>
      <option>Legendary</option>
      <option>Any</option>
    </select>
    <div class="controls-row">
      <div>
        <label>Difficulty Level</label>
        <select id="difficulty">
          <option>Easy</option>
          <option>Normal</option>
          <option>Hard</option>
          <option>Deadly</option>
          <option>Mythic</option>
        </select>
      </div>
      <div>
        <label>Setting</label>
        <select id="setting">
          <option>Dungeon</option><option>Castle</option><option>House</option><option>Swamp</option>
          <option>Cave</option><option>Forest</option><option>Village</option><option>Desert</option>
          <option>Mountain</option><option>Temple</option><option>Graveyard</option><option>Stronghold</option>
          <option>Port</option><option>Tavern</option><option>Mine</option><option>Ruins</option>
          <option>Library</option><option>Tower</option><option>Plains</option><option>Crypt</option>
        </select>
      </div>
    </div>
    <label>Roll Mode</label>
    <select id="rollmode">
      <option>Fixed</option>
      <option>Dice Roll</option>
    </select>
    <input type="text" id="diceExpr" placeholder="e.g. 2d6+1" />
    <button onclick="generateLoot()">Generate Loot</button>
    <button onclick="generateFunny()">Random Funny Items</button>
  </div>

  <div class="panel">
    <h3>Trader Options</h3>
    <label>Trader Type</label>
    <select id="trader">
      <option>None</option><option>Healer</option><option>Blacksmith</option><option>Alchemist</option>
      <option>General Store</option><option>Magic Shop</option><option>Fletcher</option><option>Butcher</option>
      <option>Jeweler</option><option>Enchanter</option><option>Stablemaster</option><option>Cartographer</option>
      <option>Exotic Pet Seller</option>
    </select>
    <label>Randomize Stock?</label>
    <select id="randomize">
      <option>No</option>
      <option>Yes</option>
    </select>
    <button onclick="generateShop()">Generate Shop Inventory</button>
    <button onclick="generateTreasure()">Generate Coins/Gems/Art</button>
  </div>

  <div class="panel" style="flex:2">
    <h3>Loot Log</h3>
    <div class="controls-row">
      <div>
        <label>Filter by Type</label>
        <select id="filterType">
          <option>All</option><option>Weapon</option><option>Armor</option><option>Potion</option><option>Wondrous</option><option>Ring</option><option>Rod</option><option>Staff</option><option>Wand</option><option>Scroll</option><option>Adventuring Gear</option>
        </select>
      </div>
      <div>
        <label>Filter by Rarity</label>
        <select id="filterRarity">
          <option>All</option><option>Common</option><option>Uncommon</option><option>Rare</option><option>Very Rare</option><option>Legendary</option>
        </select>
      </div>
    </div>
    <div id="lootLog" class="loot-log"></div>
    <button onclick="clearLog()">Clear Log</button>
    <button onclick="exportLog()">Export Log</button>
    <input type="file" id="importFile" onchange="importLog(event)" />
  </div>
</div>

<script>
// Expanded loot pool (200+ entries). Names only; no copyrighted descriptions.
const lootPools = {
  "Common":[
    // Potions & Consumables
    ["Potion of Healing","Potion",50],
    ["Antitoxin (vial)","Adventuring Gear",50],
    ["Acid (vial)","Adventuring Gear",25],
    ["Alchemist's Fire (flask)","Adventuring Gear",50],
    ["Healer's Kit","Adventuring Gear",5],
    ["Torch (10)","Adventuring Gear",0.1],
    ["Rations (1 day)","Adventuring Gear",0.5],
    ["Waterskin","Adventuring Gear",0.2],
    ["Rope, Hempen (50 ft.)","Adventuring Gear",1],
    ["Ball Bearings (bag)","Adventuring Gear",1],
    ["Caltrops (bag)","Adventuring Gear",1],
    ["Climber's Kit","Adventuring Gear",25],
    ["Grappling Hook","Adventuring Gear",2],
    ["Hunting Trap","Adventuring Gear",5],
    ["Lantern, Hooded","Adventuring Gear",5],
    ["Oil (flask)","Adventuring Gear",0.1],
    ["Tinderbox","Adventuring Gear",0.5],
    ["Vial (empty)","Adventuring Gear",1],
    ["Ink (1 oz.)","Adventuring Gear",10],
    ["Paper (one sheet)","Adventuring Gear",0.2],

    // Weapons (simple)
    ["Club","Weapon",0.1],["Dagger","Weapon",2],["Greatclub","Weapon",0.2],["Handaxe","Weapon",5],
    ["Javelin","Weapon",0.5],["Light Hammer","Weapon",2],["Mace","Weapon",5],["Quarterstaff","Weapon",0.2],
    ["Sickle","Weapon",1],["Spear","Weapon",1],["Light Crossbow","Weapon",25],["Shortbow","Weapon",25],
    ["Arrows (20)","Adventuring Gear",1],["Crossbow Bolts (20)","Adventuring Gear",1],

    // Weapons (martial)
    ["Battleaxe","Weapon",10],["Flail","Weapon",10],["Glaive","Weapon",20],["Greataxe","Weapon",30],
    ["Greatsword","Weapon",50],["Halberd","Weapon",20],["Lance","Weapon",10],["Longsword","Weapon",15],
    ["Maul","Weapon",10],["Morningstar","Weapon",15],["Pike","Weapon",5],["Rapier","Weapon",25],
    ["Scimitar","Weapon",25],["Shortsword","Weapon",10],["Trident","Weapon",5],["War Pick","Weapon",5],
    ["Warhammer","Weapon",15],["Whip","Weapon",2],

    // Armor & Shields (mundane)
    ["Padded Armor","Armor",5],["Leather Armor","Armor",10],["Studded Leather","Armor",45],
    ["Hide Armor","Armor",10],["Chain Shirt","Armor",50],["Scale Mail","Armor",50],
    ["Breastplate","Armor",400],["Half Plate","Armor",750],["Ring Mail","Armor",30],
    ["Chain Mail","Armor",75],["Splint Armor","Armor",200],["Plate Armor","Armor",1000],
    ["Shield","Armor",10]
  ],

  "Uncommon":[
    // Uncommon Magic Items (selection)
    ["+1 Weapon","Weapon",200],["+1 Armor","Armor",300],["+1 Shield","Armor",250],
    ["Boots of Elvenkind","Wondrous",250],["Cloak of Protection","Wondrous",300],["Hat of Disguise","Wondrous",350],
    ["Gloves of Swimming and Climbing","Wondrous",400],["Ring of Water Walking","Ring",300],["Ring of Jumping","Ring",200],
    ["Ring of Mind Shielding","Ring",400],["Ring of Warmth","Ring",300],["Winged Boots","Wondrous",500],
    ["Bag of Holding","Wondrous",250],["Bag of Tricks (Gray)","Wondrous",400],["Bag of Tricks (Rust)","Wondrous",400],
    ["Boots of Striding and Springing","Wondrous",300],["Bracers of Archery","Wondrous",450],
    ["Brooch of Shielding","Wondrous",250],["Cap of Water Breathing","Wondrous",200],["Cloak of Elvenkind","Wondrous",450],
    ["Driftglobe","Wondrous",100],["Eversmoking Bottle","Wondrous",250],["Goggles of Night","Wondrous",300],
    ["Immovable Rod","Rod",500],["Keoghtom's Ointment","Wondrous",200],["Lantern of Revealing","Wondrous",250],
    ["Pearl of Power","Wondrous",500],["Periapt of Wound Closure","Wondrous",350],["Pipes of Haunting","Wondrous",250],
    ["Pipes of the Sewers","Wondrous",200],["Quiver of Ehlonna","Wondrous",450],["Ring of Feather Falling","Ring",400],
    ["Ring of Swimming","Ring",250],["Robe of Useful Items","Wondrous",450],["Sending Stones","Wondrous",300],
    ["Slippers of Spider Climbing","Wondrous",400],["Stone of Good Luck (Luckstone)","Wondrous",500],
    ["Wand of Magic Detection","Wand",150],["Wand of Secrets","Wand",150],["Wand of Web","Wand",450],
    ["Weapon of Warning","Weapon",500],["Cloak of the Manta Ray","Wondrous",300],["Dust of Disappearance","Wondrous",250],
    ["Dust of Dryness","Wondrous",200],["Dust of Sneezing and Choking","Wondrous",100],["Elemental Gem","Wondrous",500],
    ["Elixir of Health","Potion",250],["Eyes of Minute Seeing","Wondrous",300],["Eyes of the Eagle","Wondrous",400],
    ["Gauntlets of Ogre Power","Wondrous",500],["Giant Slayer","Weapon",600],["Helm of Comprehending Languages","Wondrous",200],
    ["Helm of Telepathy","Wondrous",500],["Instrument of the Bards (Doss Lute)","Wondrous",500],
    ["Ioun Stone (Awareness)","Wondrous",500],["Ioun Stone (Reserve)","Wondrous",500],["Medallion of Thoughts","Wondrous",350],
    ["Mithral Armor","Armor",600],["Necklace of Adaptation","Wondrous",450],["Oil of Slipperiness","Potion",200],
    ["Potion of Animal Friendship","Potion",100],["Potion of Fire Breath","Potion",150],["Potion of Gaseous Form","Potion",250],
    ["Potion of Giant Strength (Hill)","Potion",250],["Potion of Growth","Potion",150],["Potion of Invisibility","Potion",500],
    ["Potion of Mind Reading","Potion",300],["Potion of Water Breathing","Potion",150],
    ["Ring of Animal Influence","Ring",350],["Ring of Protection","Ring",600],["Rope of Climbing","Wondrous",300],
    ["Saddle of the Cavalier","Wondrous",200],["Scarabs of Protection (single-use)","Wondrous",500],
    ["Shield (Sentinel)","Armor",450],["Staff of the Adder","Staff",450],["Staff of the Python","Staff",400],
    ["Sword of Vengeance","Weapon",250],["Tentacle Rod","Rod",500],["Wand of the War Mage +1","Wand",400]
  ],

  "Rare":[
    ["+2 Weapon","Weapon",600],["+2 Armor","Armor",800],["+2 Shield","Armor",700],
    ["Amulet of Health","Wondrous",750],["Ring of Evasion","Ring",800],["Ring of Spell Storing","Ring",950],
    ["Cape of the Mountebank","Wondrous",650],["Wand of Fireballs","Wand",900],["Staff of Withering","Staff",900],
    ["Belt of Dwarvenkind","Wondrous",900],["Boots of Speed","Wondrous",800],["Broom of Flying","Wondrous",700],
    ["Cloak of Displacement","Wondrous",900],["Cloak of the Bat","Wondrous",800],["Dimensional Shackles","Wondrous",750],
    ["Figurine of Wondrous Power (Onyx Dog)","Wondrous",800],["Figurine of Wondrous Power (Serpentine Owl)","Wondrous",800],
    ["Helm of Brilliance","Wondrous",950],["Horn of Blasting","Wondrous",650],["Ioun Stone (Protection)","Wondrous",900],
    ["Ioun Stone (Regeneration)","Wondrous",950],["Mace of Disruption","Weapon",900],["Mace of Smiting","Weapon",900],
    ["Necklace of Fireballs (Beads)","Wondrous",700],["Periapt of Proof against Poison","Wondrous",900],
    ["Pipes of Piping","Wondrous",600],["Ring of Shooting Stars","Ring",900],["Ring of X-ray Vision","Ring",700],
    ["Robe of Eyes","Wondrous",950],["Robe of Stars","Wondrous",950],["Rod of Rulership","Rod",950],
    ["Scarab of Protection","Wondrous",950],["Shield, Arrow-Catching","Armor",800],["Slippers of Spider Climbing (enhanced)","Wondrous",700],
    ["Spellguard Shield","Armor",950],["Sun Blade","Weapon",950],["Sword of Life Stealing","Weapon",900],
    ["Vorpal Longsword (lesser)","Weapon",950],["Wand of Lightning Bolts","Wand",900],["Wand of Paralysis","Wand",800],
    ["Wings of Flying","Wondrous",900],["Amulet of the Planes (tuned)","Wondrous",950],
    ["Staff of Charming","Staff",800],["Ioun Stone (Agility)","Wondrous",900],["Instrument of the Bards (Fochlucan Bandore)","Wondrous",800],
    ["Manual of Quickness of Action (charged)","Wondrous",950],["Manual of Gainful Exercise (charged)","Wondrous",950],
    ["Manual of Bodily Health (charged)","Wondrous",950],["Tome of Clear Thought (charged)","Wondrous",950],
    ["Tome of Understanding (charged)","Wondrous",950],["Tome of Leadership and Influence (charged)","Wondrous",950]
  ],

  "Very Rare":[
    ["+3 Weapon","Weapon",950],["+3 Armor","Armor",1000],["+3 Shield","Armor",1000],
    ["Rod of Absorption","Rod",1000],["Staff of Power","Staff",1000],["Vorpal Sword","Weapon",1000],
    ["Cloak of Invisibility","Wondrous",1000],["Ring of Regeneration","Ring",1000],["Ring of Spell Turning","Ring",1000],
    ["Ring of Telekinesis","Ring",950],["Ring of Free Action","Ring",900],["Ring of Water Elemental Command (tuned)","Ring",1000],
    ["Armor of Invulnerability (half-plate)","Armor",1000],["Belt of Storm Giant Strength (attuned)","Wondrous",1000],
    ["Efreeti Bottle","Wondrous",1000],["Horn of Valhalla (Bronze)","Wondrous",950],["Instrument of the Bards (Mac-Fuirmidh Cittern)","Wondrous",900],
    ["Ioun Stone (Absorption)","Wondrous",1000],["Ioun Stone (Fortitude)","Wondrous",1000],
    ["Manual of Quickness of Action (greater)","Wondrous",1000],["Manual of Gainful Exercise (greater)","Wondrous",1000],
    ["Manual of Bodily Health (greater)","Wondrous",1000],["Tome of Clear Thought (greater)","Wondrous",1000],
    ["Tome of Understanding (greater)","Wondrous",1000],["Tome of Leadership and Influence (greater)","Wondrous",1000]
  ],

  "Legendary":[
    ["Ring of Three Wishes","Ring",1000],["Deck of Many Things","Wondrous",1000],["Holy Avenger","Weapon",1000],
    ["Sphere of Annihilation","Wondrous",1000],["Rod of Lordly Might","Rod",1000],["Sword of Kas","Weapon",1000],
    ["Apparatus of Kwalish","Wondrous",1000],["Armor of Invulnerability (plate)","Armor",1000],["Crystal Ball of True Seeing","Wondrous",1000],
    ["Hammer of Thunderbolts","Weapon",1000],["Hand of Vecna","Wondrous",1000],["Eye of Vecna","Wondrous",1000],
    ["Talisman of Pure Good","Wondrous",1000],["Talisman of Ultimate Evil","Wondrous",1000],["Talisman of the Sphere","Wondrous",1000],
    ["Ring of Djinni Summoning","Ring",1000],["Cloak of Stars (legendary)","Wondrous",1000],["Staff of the Magi","Staff",1000]
  ]
};

// Funny items stay optional
const funnyItems = [
  "Rubber Chicken of Doom","Infinite Jar of Pickles","Cursed Spoon of Soup","Boots of Moonwalking",
  "The Legendary Duck Whistle","Bag of Holding... Potatoes Only","Endless Roll of Toilet Paper",
  "Mimic Plushie that Bites","Banana of Confusion","Socks of Static Shock"
];

// Treasure tables
const gemTable = ["Azurite (10 gp)","Bloodstone (50 gp)","Carnelian (50 gp)","Citrine (50 gp)","Jade (100 gp)","Pearl (100 gp)","Spinel (100 gp)","Garnet (100 gp)"];
const artTable = ["Silver Ewer (25 gp)","Carved Bone Statuette (25 gp)","Gold Ring (50 gp)","Ivory Statuette (250 gp)","Jeweled Necklace (500 gp)","Painted Gold Cloth (250 gp)","Fine Gold Chain (100 gp)"];

function rand(arr){return arr[Math.floor(Math.random()*arr.length)];}

function rarityClass(q){
  switch(q){
    case "Uncommon": return "rarity-uncommon";
    case "Rare": return "rarity-rare";
    case "Very Rare": return "rarity-very-rare";
    case "Legendary": return "rarity-legendary";
    default: return "rarity-common";
  }
}

function parseDice(expr){
  try{
    let match=expr.match(/(\d*)d(\d+)([+-]\d+)?/i);
    if(!match)return 0;
    let num=parseInt(match[1]||"1");
    let sides=parseInt(match[2]);
    let mod=parseInt(match[3]||"0");
    let total=0;
    for(let i=0;i<num;i++) total+=1+Math.floor(Math.random()*sides);
    return total+mod;
  }catch(e){return 0;}
}

function pickFromAny(){
  const cats=["Common","Uncommon","Rare","Very Rare","Legendary"];
  // Weighted pick: more common for lower tiers
  const weights=[50,30,15,4,1];
  const r=Math.random()*100;
  let acc=0;
  for(let i=0;i<cats.length;i++){ acc+=weights[i]; if(r<=acc) return cats[i]; }
  return "Common";
}

function passesFilters(type, rarity){
  const t=document.getElementById("filterType").value;
  const r=document.getElementById("filterRarity").value;
  if(t!=="All" && type!==t) return false;
  if(r!=="All" && rarity!==r) return false;
  return true;
}

function generateLoot(){
  const origin=document.getElementById("origin").value;
  const qty=parseInt(document.getElementById("quantity").value);
  const alignment=document.getElementById("alignment").value;
  let quality=document.getElementById("quality").value;
  const difficulty=document.getElementById("difficulty").value;
  const setting=document.getElementById("setting").value;
  const rollmode=document.getElementById("rollmode").value;
  const diceExpr=document.getElementById("diceExpr").value;
  let log=document.getElementById("lootLog");
  let n=qty;
  if(rollmode==="Dice Roll" && diceExpr){ n=parseDice(diceExpr); }
  for(let i=0;i<n;i++){
    if(quality==="Any") quality=pickFromAny();
    let pool=lootPools[quality]||lootPools["Common"];
    let [item,type,price]=rand(pool);
    if(!passesFilters(type, quality)) { i--; if(i>200) break; continue; } // avoid infinite loop
    let spanClass=alignment==="Cursed"?"bad":alignment==="Blessed"?"good":"";
    let rarity=rarityClass(quality);
    if(item.toLowerCase().includes("healing")) rarity="healing";
    log.innerHTML+=`<div class="loot-item"><span class="${rarity}"><b>${item}</b></span> <small>(${type}, ${quality})</small> from <i>${origin}</i> in <i>${setting}</i> [${difficulty}] <span class="${spanClass}">${alignment!=="Neutral"?alignment:""}</span></div>`;
  }
}

function generateShop(){
  const trader=document.getElementById("trader").value;
  if(trader==="None")return;
  const randomize=document.getElementById("randomize").value==="Yes";
  let stock=[];
  if(randomize){
    let count=5+Math.floor(Math.random()*7);
    let cats=["Common","Uncommon","Rare","Very Rare","Legendary"];
    for(let i=0;i<count;i++){
      let q=pickFromAny();
      let [item,type,price]=rand(lootPools[q]);
      let rarity=rarityClass(q);
      if(item.toLowerCase().includes("healing")) rarity="healing";
      stock.push(`<span class='${rarity}'>${item}</span> <small>(${type}, ${q})</small> <span class='price'>${price} gp</span>`);
    }
  }else{
    stock=lootPools["Common"].slice(0,6).map(([it,type,price])=>`<span class='rarity-common'>${it}</span> <small>(${type}, Common)</small> <span class='price'>${price} gp</span>`);
  }
  let log=document.getElementById("lootLog");
  log.innerHTML+=`<div class="loot-item"><b>${trader} Stock:</b><br> • ${stock.join("<br> • ")}</div>`;
}

function generateTreasure(){
  // Coins scale a bit with randomness
  let gp=50+Math.floor(Math.random()*150);
  let sp=100+Math.floor(Math.random()*500);
  let cp=200+Math.floor(Math.random()*800);
  let coins=`${gp} gp, ${sp} sp, ${cp} cp`;
  let gems=[]; for(let i=0;i<Math.floor(Math.random()*4);i++){gems.push(rand(gemTable));}
  let arts=[]; for(let i=0;i<Math.floor(Math.random()*3);i++){arts.push(rand(artTable));}
  let log=document.getElementById("lootLog");
  log.innerHTML+=`<div class="loot-item"><b>Treasure Hoard:</b> ${coins} | Gems: ${gems.join(", ")||"—"} | Art: ${arts.join(", ")||"—"}</div>`;
}

function generateFunny(){
  let count=1+Math.floor(Math.random()*3);
  let log=document.getElementById("lootLog");
  for(let i=0;i<count;i++){
    log.innerHTML+=`<div class="loot-item"><span class="funny"><b>${rand(funnyItems)}</b></span> (Funny)</div>`;
  }
}

function clearLog(){
  document.getElementById("lootLog").innerHTML="";
}

function exportLog(){
  let content=document.getElementById("lootLog").innerHTML;
  let blob=new Blob([content],{type:"text/html"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="lootlog.html";
  a.click();
}

function importLog(event){
  let file=event.target.files[0];
  if(!file)return;
  let reader=new FileReader();
  reader.onload=function(e){
    document.getElementById("lootLog").innerHTML=e.target.result;
  }
  reader.readAsText(file);
}
</script>
</body>
</html>