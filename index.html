<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>D&D Ultimate Loot Generator</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#eee}
  header{background:#222;padding:12px;text-align:center;font-size:20px;font-weight:bold;border-bottom:2px solid #444}
  .container{display:flex;flex-wrap:wrap;padding:12px;gap:12px}
  .panel{background:#1b1b1b;padding:12px;border:1px solid #333;border-radius:8px;flex:1;min-width:280px;max-height:700px;overflow:auto}
  label{display:block;margin:6px 0 2px;font-size:13px;color:#bbb}
  select,input[type=number],input[type=text]{width:100%;padding:6px;border-radius:4px;border:1px solid #444;background:#222;color:#eee}
  button{background:#4cafef;color:#111;padding:10px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin-top:10px;width:100%}
  button:hover{background:#6ccfff}
  .loot-log{max-height:600px;overflow-y:auto;font-size:14px;background:#0d0d0d;padding:10px;border-radius:6px;border:1px solid #333}
  .loot-item{border-bottom:1px solid #333;padding:4px 0}
  .good{color:#4ae18f}
  .bad{color:#e14a4a}
  .rarity-common{color:#ccc}
  .rarity-uncommon{color:#1eff00}
  .rarity-rare{color:#0070dd}
  .rarity-very-rare{color:#a335ee}
  .rarity-legendary{color:#ff8000}
  .healing{color:#ff4d4d;font-weight:bold}
  .funny{color:#ffd700}
  .price{color:#f0e68c; font-size:13px}
</style>
</head>
<body>
<header>D&D Ultimate Loot Generator</header>
<div class="container">
  <div class="panel">
    <h3>Loot Options</h3>
    <label>Origin</label>
    <select id="origin">
      <option>Chest</option>
      <option>Enemy</option>
      <option>Boss</option>
      <option>Container</option>
      <option>Pickpocket</option>
    </select>
    <label>Quantity</label>
    <input type="number" id="quantity" value="3" min="1" max="50">
    <label>Cursed / Blessed</label>
    <select id="alignment">
      <option>Neutral</option>
      <option>Cursed</option>
      <option>Blessed</option>
    </select>
    <label>Loot Quality</label>
    <select id="quality">
      <option>Common</option>
      <option>Uncommon</option>
      <option>Rare</option>
      <option>Very Rare</option>
      <option>Legendary</option>
    </select>
    <label>Difficulty Level</label>
    <select id="difficulty">
      <option>Easy</option>
      <option>Normal</option>
      <option>Hard</option>
      <option>Deadly</option>
      <option>Mythic</option>
    </select>
    <label>Setting</label>
    <select id="setting">
      <option>Dungeon</option><option>Castle</option><option>House</option><option>Swamp</option>
      <option>Cave</option><option>Forest</option><option>Village</option><option>Desert</option>
      <option>Mountain</option><option>Temple</option><option>Graveyard</option><option>Stronghold</option>
      <option>Port</option><option>Tavern</option><option>Mine</option><option>Ruins</option>
      <option>Library</option><option>Tower</option><option>Plains</option><option>Crypt</option>
    </select>
    <label>Roll Mode</label>
    <select id="rollmode">
      <option>Fixed</option>
      <option>Dice Roll</option>
    </select>
    <input type="text" id="diceExpr" placeholder="e.g. 2d6+1" />
    <button onclick="generateLoot()">Generate Loot</button>
    <button onclick="generateFunny()">Random Funny Items</button>
  </div>

  <div class="panel">
    <h3>Trader Options</h3>
    <label>Trader Type</label>
    <select id="trader">
      <option>None</option><option>Healer</option><option>Blacksmith</option><option>Alchemist</option>
      <option>General Store</option><option>Magic Shop</option><option>Fletcher</option><option>Butcher</option>
      <option>Jeweler</option><option>Enchanter</option><option>Stablemaster</option><option>Cartographer</option>
      <option>Exotic Pet Seller</option>
    </select>
    <label>Randomize Stock?</label>
    <select id="randomize">
      <option>No</option>
      <option>Yes</option>
    </select>
    <button onclick="generateShop()">Generate Shop Inventory</button>
    <button onclick="generateTreasure()">Generate Coins/Gems/Art</button>
  </div>

  <div class="panel" style="flex:2">
    <h3>Loot Log</h3>
    <div id="lootLog" class="loot-log"></div>
    <button onclick="clearLog()">Clear Log</button>
    <button onclick="exportLog()">Export Log</button>
    <input type="file" id="importFile" onchange="importLog(event)" />
  </div>
</div>

<script>
// Simplified large loot pool with names & prices
const lootPools = {
  "Common":[
    ["Potion of Healing",50],["Dagger",2],["Shortsword",10],["Club",0.1],["Leather Armor",10],
    ["Shield",10],["Spear",1],["Quarterstaff",0.2],["Light Crossbow",25],["Arrows (20)",1]
  ],
  "Uncommon":[
    ["+1 Weapon",200],["Cloak of Protection",300],["Boots of Elvenkind",250],["Ring of Water Walking",300],
    ["Winged Boots",500],["Gloves of Swimming and Climbing",400],["Hat of Disguise",350]
  ],
  "Rare":[
    ["+2 Weapon",600],["Amulet of Health",750],["Bag of Holding",250],["Wand of Fireballs",900],
    ["Ring of Evasion",800],["Rod of Rulership",950],["Cape of the Mountebank",650]
  ],
  "Very Rare":[
    ["+3 Weapon",950],["Rod of Absorption",1000],["Vorpal Sword",1000],["Staff of Power",1000],
    ["Ring of Regeneration",1000],["Cloak of Invisibility",1000]
  ],
  "Legendary":[
    ["Ring of Three Wishes",1000],["Deck of Many Things",1000],["Holy Avenger",1000],["Sphere of Annihilation",1000],
    ["Rod of Lordly Might",1000],["Sword of Kas",1000]
  ]
};

const funnyItems = [
  "Rubber Chicken of Doom","Infinite Jar of Pickles","Cursed Spoon of Soup","Boots of Moonwalking",
  "The Legendary Duck Whistle","Bag of Holding... Potatoes Only","Endless Roll of Toilet Paper",
  "Mimic Plushie that Bites","Banana of Confusion","Socks of Static Shock"
];

const gemTable = ["Azurite (10 gp)","Bloodstone (50 gp)","Carnelian (50 gp)","Citrine (50 gp)","Jade (100 gp)","Pearl (100 gp)"];
const artTable = ["Silver Ewer (25 gp)","Carved Bone Statuette (25 gp)","Gold Ring (50 gp)","Ivory Statuette (250 gp)","Jeweled Necklace (500 gp)"];

function rand(arr){return arr[Math.floor(Math.random()*arr.length)];}

function rarityClass(q){
  switch(q){
    case "Uncommon": return "rarity-uncommon";
    case "Rare": return "rarity-rare";
    case "Very Rare": return "rarity-very-rare";
    case "Legendary": return "rarity-legendary";
    default: return "rarity-common";
  }
}

function parseDice(expr){
  try{
    let match=expr.match(/(\d*)d(\d+)([+-]\d+)?/i);
    if(!match)return 0;
    let num=parseInt(match[1]||"1");
    let sides=parseInt(match[2]);
    let mod=parseInt(match[3]||"0");
    let total=0;
    for(let i=0;i<num;i++) total+=1+Math.floor(Math.random()*sides);
    return total+mod;
  }catch(e){return 0;}
}

function generateLoot(){
  const origin=document.getElementById("origin").value;
  const qty=parseInt(document.getElementById("quantity").value);
  const alignment=document.getElementById("alignment").value;
  const quality=document.getElementById("quality").value;
  const difficulty=document.getElementById("difficulty").value;
  const setting=document.getElementById("setting").value;
  const rollmode=document.getElementById("rollmode").value;
  const diceExpr=document.getElementById("diceExpr").value;
  let log=document.getElementById("lootLog");
  let n=qty;
  if(rollmode==="Dice Roll" && diceExpr){
    n=parseDice(diceExpr);
  }
  for(let i=0;i<n;i++){
    let pool=lootPools[quality]||lootPools["Common"];
    let [item,price]=rand(pool);
    let spanClass=alignment==="Cursed"?"bad":alignment==="Blessed"?"good":"";
    let rarity=rarityClass(quality);
    if(item.toLowerCase().includes("healing")) rarity="healing";
    log.innerHTML+=`<div class="loot-item"><span class="${rarity}"><b>${item}</b></span> (${quality}) from <i>${origin}</i> in <i>${setting}</i> [${difficulty}] <span class="${spanClass}">${alignment!=="Neutral"?alignment:""}</span></div>`;
  }
}

function generateShop(){
  const trader=document.getElementById("trader").value;
  if(trader==="None")return;
  const randomize=document.getElementById("randomize").value==="Yes";
  let stock=[];
  if(randomize){
    let count=3+Math.floor(Math.random()*5);
    let qualities=Object.keys(lootPools);
    for(let i=0;i<count;i++){
      let q=rand(qualities);
      let [item,price]=rand(lootPools[q]);
      let rarity=rarityClass(q);
      if(item.toLowerCase().includes("healing")) rarity="healing";
      stock.push(`<span class='${rarity}'>${item}</span> <span class='price'>${price} gp</span>`);
    }
  }else{
    stock=lootPools["Common"].slice(0,3).map(([it,price])=>`<span class='rarity-common'>${it}</span> <span class='price'>${price} gp</span>`);
  }
  let log=document.getElementById("lootLog");
  log.innerHTML+=`<div class="loot-item"><b>${trader} Stock:</b> ${stock.join(", ")}</div>`;
}

function generateTreasure(){
  let coins=`${Math.floor(Math.random()*100)} gp, ${Math.floor(Math.random()*500)} sp, ${Math.floor(Math.random()*1000)} cp`;
  let gems=[]; for(let i=0;i<Math.floor(Math.random()*3);i++){gems.push(rand(gemTable));}
  let arts=[]; for(let i=0;i<Math.floor(Math.random()*2);i++){arts.push(rand(artTable));}
  let log=document.getElementById("lootLog");
  log.innerHTML+=`<div class="loot-item"><b>Treasure Hoard:</b> ${coins} | Gems: ${gems.join(", ")} | Art: ${arts.join(", ")}</div>`;
}

function generateFunny(){
  let count=1+Math.floor(Math.random()*3);
  let log=document.getElementById("lootLog");
  for(let i=0;i<count;i++){
    log.innerHTML+=`<div class="loot-item"><span class="funny"><b>${rand(funnyItems)}</b></span> (Funny)</div>`;
  }
}

function clearLog(){
  document.getElementById("lootLog").innerHTML="";
}

function exportLog(){
  let content=document.getElementById("lootLog").innerHTML;
  let blob=new Blob([content],{type:"text/html"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="lootlog.html";
  a.click();
}

function importLog(event){
  let file=event.target.files[0];
  if(!file)return;
  let reader=new FileReader();
  reader.onload=function(e){
    document.getElementById("lootLog").innerHTML=e.target.result;
  }
  reader.readAsText(file);
}
</script>
</body>
</html>